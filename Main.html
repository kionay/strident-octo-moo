<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	window.records = [];
	$("#inputBox").keypress(function(e){
	    if(e.keyCode==13){
	        $("#recordButton").click();
	        $("#inputBox,#bigTextInput").val("");
	    }
	});
	$("#bigTextInput").hide();
	$("#bigInputCheck").click(function(){
		$("#inputBox").toggle(!this.checked).val("");
		$("#bigTextInput").toggle(this.checked).val("");
	});

	window.setInterval(function(){
		onTestBoxInput()
	}, 500);
});

function onTestBoxInput(){
	var inList = false;
	var testWords = $("#testBox").val().toLowerCase().split(" ");
	var testFrequencies = [];
	var placeInSortedList = 0;
	for(var wordIndex = 0; wordIndex < testWords.length; wordIndex++){
		for(var exIndex = 0; exIndex < excludeList.length; exIndex++){
			inList = (excludeList[exIndex] == testWords[wordIndex] || inList == true)?(true):(false);
		}
		if(!inList){
			placeInSortedList = wordInFrequencyList(testWords[wordIndex],window.sortedFrequency);
			if(placeInSortedList >= 0) {
				testFrequencies.push(window.sortedFrequency[placeInSortedList][1]);
			}
		}
	}
	var totalFrequency = 0;
	if(testFrequencies.length > 0){
		for(var frequencyIndex = 0; frequencyIndex < testFrequencies.length; frequencyIndex++){
			totalFrequency += testFrequencies[frequencyIndex];
		}
	}
	
	totalFrequency /= testFrequencies.length
	if(totalFrequency > 0.01){
		document.getElementById("testBoxOutput").innerHTML = totalFrequency.toFixed(2) + "%";
	} else {
		document.getElementById("testBoxOutput").innerHTML = "00.00%"
	}
}

var excludeList = [" ","","\n",".",",","?","!","\"","'","/","\\",":","(",")","[","]","^"]

function record(){
	var linedInput = $(
			($("#inputBox").is(":visible")) //if inputBox is visible
				?	("#inputBox")   //then use inputBox
				:	("#bigTextInput")//else use bigTextInput (textArea)
			).val().split("\n");
	
	$.each(linedInput,function(index,value){ //for each line
		var splitOnSpace = value.split(" ");
		$.each(splitOnSpace, function (wordIndex, wordValue) { //for each word
			var inList = false;
			/*for(var exIndex = 0; exIndex < excludeList.length; exIndex++){
				inList = (excludeList[exIndex] == wordValue || inList == true)?(true):(false);
			}*/
		    	if(!inList){
				/*
					The next two IF statements exist due to artifacts of IFTTT recording text messages.
					This is my primary source of input, and many lines will have a trailing or leading useless quote mark.
					If your input contains quoted texts consider removing them entirely.
					I suggest this in case the input is, like mine, from text messages as quoted text is not 'from' the person.
					This would mean that the quoted text may not follow the same pattern as the rest of the input, and could throw the numbers off.
					By all means remove these and the result may very well be the same.
				*/
				if(wordValue.charAt(0) == "\""){
					wordValue = wordValue.substring(1);
				}
				if(wordValue.charAt(wordValue.length-1)=="\""){
					wordValue = wordValue.substring(0, wordValue.length-1);
				}
				window.records.push(wordValue.toLowerCase());
		    	}
		});
		$("#listId").append("<li>" + value + "</li>");
	});
	$("#bigTextInput").val("");
	initiateAfterRecord();
}

function initiateAfterRecord(){
	//window.rankedFrequency = rankWordFrequencyUnordered(window.records);
	//window.sortedFrequency = mergeSort(rankedFrequency);
}

function wordFrequency(givenWord){
	var occurrences = 0;
	var matchResults = [];
	//console.log("word frequency for " + givenWord);

	/* 
		faster occurences algorithm from http://www.shamasis.net/2009/09/fast-algorithm-to-find-unique-items-in-javascript-array/
	*/
	var o = {}, i, l = window.records.length, r = 0;
	for(i=0; i < l; i+=1) i[window.records[i]] = window.records[i];
	for(i in o) r++;

	occurrences = r;	
	var returnPercentage = ((occurrences / $(window).attr("records").length*100)||0).toFixed(2)
	return parseFloat(returnPercentage)
}

function mergeSort(inArray){
	if(inArray.length<=1) return inArray;
	
	var leftArray = [];
	var rightArray = [];
	var midPoint = inArray.length / 2;
	
	//populate left and right arrays
	for(var item = 0; item < inArray.length; item++){
		if(item < midPoint){ leftArray.push(inArray[item]); }
		else { rightArray.push(inArray[item]); }
	}

	//sort each smaller list
	leftArray = mergeSort(leftArray);
	rightArray = mergeSort(rightArray);

	//combine(merge) smaller sorted lists
	return merge(leftArray, rightArray);
}

function merge(leftArray, rightArray){
	var mergedArray = [];

	while(leftArray.length != 0 && rightArray.length != 0)
	{
		if(leftArray[0][1] <= rightArray[0][1]){ 
			mergedArray.push(leftArray[0]);
			leftArray.shift();
		} else {
			mergedArray.push(rightArray[0]);
			rightArray.shift();
		}
	}

	while(leftArray.length != 0){
		mergedArray.push(leftArray[0]);
		leftArray.shift();
	}
	while(rightArray.length != 0){
		mergedArray.push(rightArray[0]);
		rightArray.shift();
	}

	return mergedArray;
	
}

function rankWordFrequencyUnordered(rankedArray){
	var unorderedFrequency = [];
	
	$.each(rankedArray, function (index, value) {
		//console.log("Processing word \"" + value + "\"");
		if(wordInFrequencyList(value,unorderedFrequency)== -1){
			//new word, find frequency, add to list
			unorderedFrequency.push([value,wordFrequency(value)]);
		}
	});

	return unorderedFrequency;
}


function wordInFrequencyList(word, list){
	for(var index = 0; index < list.length; index++){
		if(list[index][0] == word.replace(new RegExp((word[0]==":")?('[,?.!"]'):('[,?.!)"(]'), 'g'))) return index;
	}
	return -1;
}

function jQueryInArray(ArrayToSearch, SampleArrayItemToSearchFor){
	return $.inArray(SampleArrayItemToSearchFor.replace(new RegExp('[,?.!)(]', 'g'), ''), ArrayToSearch);
}

</script>
</head>
<body>
<input type="button" id="recordButton" value="Record" onclick="record()"/>
<br>
Big Input Mode <input type="checkbox" id="bigInputCheck"/>
<br>
<input type="text" id="inputBox" placeholder="Enter Text Here."/>
<textarea rows="10" cols="60" id="bigTextInput" placeholder="Enter Text Here. Input will be seperated line-by-line."></textarea>
<br><br>
<input type="text" id="testBox" placeholder="test new text frequency here."/> <label id="testBoxOutput">00.00%</label>
<br>
<ol id="listId">
</ol>
</body>
</html>
